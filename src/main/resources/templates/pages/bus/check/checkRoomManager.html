<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>实验室归还</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="/css/index.css" media="all"/>
    <link rel="stylesheet" href="/layui_ext/dtree/dtree.css">
    <link rel="stylesheet" href="/layui_ext/dtree/font/dtreefont.css">
</head>
<body class="main_body">

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>查询条件</legend>
</fieldset>
<form class="layui-form" method="post">
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">借出单号:</label>
            <div class="layui-input-inline">
                <input style="width: 260px" type="text" id="rentid" name="rentid" lay-verify="title" placeholder="请输入借出单号" autocomplete="off"
                       class="layui-input">
            </div>
        </div>

        <div class="layui-inline" style="margin-left: 60px">
            <div class="layui-input-inline">
                <button type="button" id="idsubmit" class="layui-btn  layui-btn-normal ">
                    <i class="layui-icon layui-icon-search"></i>查询</button>
                <button type="reset" class="layui-btn  layui-btn-warm ">
                    <i class="layui-icon layui-icon-refresh"></i>重置</button>
            </div>
        </div>
    </div>
</form>

<table class="layui-hide" id="test" lay-filter="test"></table>

<div style="display: none;padding: 20px" id="dataGrip">
    <form class="layui-form" method="post" id="dataForm" lay-filter="dataForm">
        <blockquote class="layui-elem-quote layui-text">检查单表单</blockquote>
        <input type="hidden" name="roomnumber" id="roomnum">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">检查单号:</label>
                <div class="layui-input-block">
                    <input style="width: 260px" type="text" id="checkid" name="checkid" disabled lay-verify="name" autocomplete="off" placeholder="请输入检查单号"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">借出单号:</label>
                <div class="layui-input-block">
                    <input style="width: 260px" type="text" id="reid" name="rentid" disabled lay-verify="name" autocomplete="off" placeholder="请输入借出单号"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">操作员:</label>
                <div class="layui-input-block">
                    <input style="width: 260px" type="text" id="admin" name="admin" disabled lay-verify="name" autocomplete="off" placeholder="请输入操作员姓名"
                           class="layui-input">
                </div>
            </div>

        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">存在问题:</label>
                <div class="layui-input-block">
                    <input style="width: 260px" type="text" id="checkproblem" name="checkproblem" lay-verify="name" autocomplete="off" placeholder="输入存在的问题"
                           class="layui-input">
                </div>
            </div>
            <!--<div class="layui-inline">-->
                <!--<label class="layui-form-label">赔付金额:</label>-->
                <!--<div class="layui-input-block">-->
                    <!--<input style="width: 260px" type="text" id="paymoney" name="paymoney" lay-verify="name" autocomplete="off" placeholder=""-->
                           <!--class="layui-input">-->
                <!--</div>-->
            <!--</div>-->
            <div class="layui-inline">
                <label class="layui-form-label">检查时间:</label>
                <div class="layui-input-block">
                    <input style="width: 260px" type="text" name="checkTime" placeholder="请输入检查时间" class="layui-input"  id="test1">
                </div>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">问题描述</label>
            <div class="layui-input-block">
                <textarea name="checkdesc" placeholder="请输入问题描述" class="layui-textarea"></textarea>
            </div>
        </div>


        <div class="layui-form-item">
            <div style="text-align: center">
                <button type="submit" class="layui-btn layui-btn-warm layui-btn-radius" lay-submit=""
                        lay-filter="demo1">
                    <span class="layui-icon">&#xe609;</span>
                    提交
                </button>
                <button type="reset" class="layui-btn layui-btn-normal layui-btn-radius">
                    <span class="layui-icon">&#x1007;</span>
                    重置
                </button>
            </div>
        </div>
    </form>

    <div style="padding: 20px; background-color: #F2F2F2;">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-header">车辆信息</div>
                    <div class="layui-card-body">
                        实验室编号:  <span id="roomnumber"></span>  <br>
                        实验室名称:  <span id="roomname"></span>  <br>
                        实验室类型:  <span id="roomtype"></span>  <br>
                        所属院系:  <span id="roomdepartment"></span>  <br>
                        地址:  <span id="roomaddress"></span>  <br>
                        实验室简介:  <span id="description"></span>  <br>
                        车辆图片:  <img src="" id="roomSrc" style="height: 145px;width: 200px">
                    </div>
                </div>
            </div>
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-header">出借用单信息</div>
                    <div class="layui-card-body">
                        借出单单号: <span id="rid"></span> <br>
                        开始时间: <span id="begintime"></span> <br>
                        归还时间: <span id="returntime"></span> <br>
                        操作员: <span id="rentadmin"></span>
                    </div>
                </div>
            </div>
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-header">学生信息</div>
                    <div class="layui-card-body">
                        学生学号: <span id="studentid"></span> <br>
                        学生姓名: <span id="stuname"></span> <br>
                        学生性别: <span id="stusex"></span> <br>
                        班级代号: <span id="stuclassid"></span> <br>
                        所属院系: <span id="department"></span> <br>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>




<script type="text/javascript" src="/layui/layui.js"></script>

<script>
    var tableForm;
    var time;   //定义全局变量,存放当前时间
    layui.use(['table', 'form','jquery', 'laydate', 'layer'], function () {
        var table = layui.table, layer = layui.layer, form = layui.form,$ = layui.$,laydate = layui.laydate;
        laydate.render({
            //指定日期input框的id值
            elem: '#test1',
            type: 'datetime'
        });


        $("#idsubmit").click(function () {
            var rentid = $("#rentid").val();
            $.get("/busRents/queryRentId?rentid="+rentid,function (obj) {
                // console.log(obj)
                if (obj == null || obj == ""){
                    layer.alert("单号错误,请确认",{icon: 2})
                }else {
                    if(obj.rentflag == 1){
                        layer.alert("您输入的借出单号相关车辆已经归还,无需在入库",{icon: 0})
                    }else {
                        //显示div $("#id").show()表示display:block,
                        // $("#id").hide()表示display:none;
                        // $("#id").toggle()切换元素的可见状态
                        $("#dataGrip").show();
                        $.get("/busChecks/crydomain?rentid="+rentid,function (res) {
                            roomFun(res);//汽车卡片信息赋值方法
                            rentFun(res);//出租单卡片信息赋值
                            student(res);//客户卡片信息赋值

                            Date.prototype.Format = function (fmt) { //author: meizz
                                var o = {
                                    "M+": this.getMonth() + 1, //月份
                                    "d+": this.getDate(), //日
                                    "H+": this.getHours(), //小时
                                    "m+": this.getMinutes(), //分
                                    "s+": this.getSeconds(), //秒
                                    "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                                    "S": this.getMilliseconds() //毫秒
                                };
                                if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
                                for (var k in o)
                                    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                return fmt;
                            }
                            time = new Date().Format("yyyy-MM-dd HH:mm:ss");//获取当前时间
                            time1 = new Date().Format("yyyyMMdd");//获取当前时间
                            time2 = new Date().Format("HHmmsss");
                            var identity = res.customer.identity;
                            var id2 = identity.substring(0,3);
                            var id3 = identity.substring(13,18);
                            //拼接检查单单号
                            var checkid = "JC_"+time1+"_"+time2+"_"+id2+"_"+id3;
                            $("#checkid").val(checkid);//检查单单号赋值
                            $("#reid").val(res.rent.rentid)//借出单号赋值
                            $("#admin").val(res.rent.admin)//借出单号赋值
                            $("#test1").val(time)//借出单号赋值
                            $("#roomnum").val(res.room.student)
                        })
                    }

                }

            })
        })
        //实验室卡片信息赋值
        function roomFun(res){
            console.log(res.room.roomnumber)
            $("#roomnumber") .text(res.room.roomnumber);
            $("#roomname") .text(res.room.roomname);
            $("#roomtype") .text(res.room.roomtype);
            $("#roomdepartment") .text(res.room.department);
            $("#roomaddress") .text(res.room.roomaddress);
            $("#description") .text(res.room.description);
            $("#roomSrc").attr("src", "/roomimgs/" + res.room.roomimg);
        }
        //借出单卡片信息赋值
        function rentFun(res) {
            console.log(res.rent.begintime)
            $("#rid") .text(res.rent.rentid);
            $("#begintime") .text(res.rent.begintime);
            $("#returntime") .text(res.rent.returntime);
            $("#rentadmin") .text(res.rent.admin);
        }
        //学生卡片信息赋值
        function student(res) {
            $("#studentid") .text(res.student.studentid);
            $("#stuname") .text(res.student.stuname);
            $("#stusex") .text(res.student.stusex);
            $("#stuclassid") .text(res.student.stuclassid);
            $("#department") .text(res.student.department);
        }

        //提交数据checkdate
        form.on("submit(demo1)", function () {

            $("#admin").removeAttr("disabled");
            $("#checkid").removeAttr("disabled");
            $("#reid").removeAttr("disabled");
            $("#problem").removeAttr("disabled");
            $("#paymoney").removeAttr("disabled");
            var params = $("#dataForm").serialize();
            $.post("/busChecks/addCheck", params, function (obj) {
                layer.alert("归还成功",{icon: 1})
            })
        })

    });


</script>
</body>
</html>


